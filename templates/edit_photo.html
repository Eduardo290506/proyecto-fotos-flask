<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Editar foto</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script defer src="{{ url_for('static', filename='ui.js') }}"></script>
</head>
<body>
  <header class="topbar">
    <strong>Editar foto</strong>
    <div>
      <a class="btn" href="{{ url_for('dashboard') }}">Volver</a>
      <a class="btn" href="{{ url_for('logout') }}">Salir</a>
    </div>
  </header>

  <main class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="msgs">
          {% for category, msg in messages %}
            <p class="msg {{ category }}">{{ msg }}</p>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="card" style="max-width:820px;">
      <img
        style="width:100%; border-radius:10px; margin-bottom:12px; display:block;"
        src="{{ url_for('uploaded_file', filepath=(photo['filepath'] if photo['filepath'] else 'general/' ~ photo['filename'])) }}"
        alt=""
      >

      <form method="post">
        <label>Nombre o código</label>
        <input name="display_name" value="{{ photo['display_name'] }}" required>

        <label>Descripción</label>
        <textarea name="description" placeholder="Breve descripción...">{{ photo['description'] or '' }}</textarea>

        <label>Proyecto</label>
        <select name="project_id" required>
          {% for pr in projects %}
            <option value="{{ pr['id'] }}" {% if photo['project_id'] == pr['id'] %}selected{% endif %}>
              {{ pr['name'] }}
            </option>
          {% endfor %}
        </select>

        <button type="submit" style="margin-top:10px;">Guardar cambios</button>
      </form>

      <hr style="margin:16px 0;">

      <form method="post" action="{{ url_for('delete_photo', photo_id=photo['id']) }}" data-confirm-message="¿Eliminar esta foto? Esta acción no se puede deshacer.">
        <button class="btn" type="submit">Eliminar foto</button>
      </form>

      <p class="muted small" style="margin-top:10px;">
        Nota: si cambias el proyecto, el archivo se moverá a la carpeta del nuevo proyecto automáticamente.
      </p>
    </div>
  </main>
  <div class="modal" id="modalConfirm" aria-hidden="true">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-dialog modal-confirm">
      <div class="modal-head">
        <div>
          <h3 class="h3">Confirmar acción</h3>
          <p class="muted small confirm-message">¿Seguro que deseas continuar?</p>
        </div>
        <button class="icon-btn" type="button" data-close aria-label="Cerrar">✕</button>
      </div>
      <div class="modal-actions" style="padding:16px;">
        <button class="btn btn-primary" type="button" data-confirm-accept>Aceptar</button>
        <button class="btn btn-ghost" type="button" data-close>Cancelar</button>
      </div>
    </div>
  </div>
</body>
</html>
